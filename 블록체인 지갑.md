## 1. 회원가입 및 지갑 생성 통합 흐름
- **시작**
  - 사용자가 회원가입 요청
- **단계 1: 회원가입 처리**
  - 사용자 정보 입력 (예: 이메일, 비밀번호 등)
  - DB에 사용자 저장
    - `Users` 테이블에 새 사용자 생성
    - `balance` 필드 디폴트 값 0으로 설정
    - `userId` 생성 (예: MongoDB의 ObjectId)
  - 회원가입 성공
- **단계 2: 지갑 생성 요청 (자동 호출)**
  - 회원가입 완료 후 바로 지갑 생성 요청 트리거
    - 회원가입 API 내부에서 `createWallet(userId)` 호출
- **단계 3: 사용자 ID 확인**
  - 방금 생성된 `userId`로 DB 조회
    - 없음: 오류 메시지 반환 ("사용자 없음") → 드물게 발생
    - 있음: 다음 단계
- **단계 4: 지갑 생성**
  - `ethers.js`로 랜덤 개인 키와 공개 키 생성
  - 공개 키에서 지갑 주소 도출
- **단계 5: DB 업데이트**
  - `Users` 테이블에 지갑 정보 저장
    - `wallet_address`에 지갑 주소 저장
    - `private_key` 저장 (암호화 권장)
- **단계 6: 블록체인 로그 기록**
  - "WALLET_CREATE" 이벤트로 로그 기록
    - 사용자 ID, 지갑 주소 포함
- **단계 7: 응답**
  - 회원가입 성공 메시지와 지갑 주소 반환
- **종료**

## 2. 예외 처리
- **지갑 생성 실패 시**
  - `ethers.js` 오류 발생: 회원가입은 성공, 지갑 생성은 재시도 안내
  - DB 저장 실패: 롤백 후 오류 반환
- **로그 기록 실패 시**
  - 로그는 비동기로 처리, 실패해도 회원가입/지갑 생성은 유지

## 3. Security 연계
- **Trust Score**: 회원가입 후 지갑 생성은 정상 행동이므로 점수 변화 없음.
- **블록체인 로그**: 무결성 보장, 나중에 지갑 관련 트랜잭션 추적 가능.

## 4. 전체 흐름 요약
- **시작**: 회원가입 요청
- **회원가입**: 사용자 저장, `balance` 0 설정
- **지갑 생성**: 자동 요청 → 키 생성 → DB 저장 → 로그 기록
- **종료**: 성공 응답

## 5. 구현 팁 (코드 없이)
- 회원가입 API에서 `createWallet()` 호출하도록 설계.
- `balance`는 0으로 시작, 이후 KakaoPay 결제나 멤버십 차감으로 변동.
- 개인 키는 암호화 필수(보안 강화).
